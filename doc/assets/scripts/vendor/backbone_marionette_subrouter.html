<!DOCTYPE html><html lang="en"><head><title>assets/scripts/vendor/backbone_marionette_subrouter</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../../"><meta name="groc-document-path" content="assets/scripts/vendor/backbone_marionette_subrouter"><meta name="groc-project-path" content="assets/scripts/vendor/backbone_marionette_subrouter.js"><link rel="stylesheet" type="text/css" media="all" href="../../../assets/style.css"><script type="text/javascript" src="../../../assets/behavior.js"></script><body><div id="meta"><div class="file-path">assets/scripts/vendor/backbone_marionette_subrouter.js</div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><p>This is heavily based on Backbone.SubRoute 
(<a href="https://github.com/ModelN/backbone.subroute">https://github.com/ModelN/backbone.subroute</a>) by Dave Cadwallader</p></div></div><div class="code"><div class="wrapper">(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(factory)</span> {</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> define === <span class="hljs-string">'function'</span> &amp;&amp; define.amd) {
        define([<span class="hljs-string">'underscore'</span>, <span class="hljs-string">'backbone'</span>, <span class="hljs-string">'marionette'</span>], factory);
    } <span class="hljs-keyword">else</span> {
        factory(_, Backbone, Marionette);
    }
}(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_, Backbone)</span> {</span>
    Marionette.SubRouter = Marionette.AppRouter.extend({
        constructor: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(options)</span> {</span>
 
            <span class="hljs-keyword">var</span> routes = {};
 </div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Prefix is optional, set to empty string if not passed</p></div></div><div class="code"><div class="wrapper">            <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.prefix === <span class="hljs-literal">undefined</span>){
                <span class="hljs-keyword">this</span>.prefix = prefix = options.prefix || <span class="hljs-string">""</span>;
            } <span class="hljs-keyword">else</span> {
                 prefix = <span class="hljs-keyword">this</span>.prefix;
            }
 </div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>SubRoute instances may be instantiated using a prefix with or without a trailing slash.
If the prefix does <em>not</em> have a trailing slash, we need to insert a slash as a separator
between the prefix and the sub-route path for each route that we register with Backbone.</p></div></div><div class="code"><div class="wrapper">            <span class="hljs-keyword">this</span>.separator = (prefix.slice(-<span class="hljs-number">1</span>) === <span class="hljs-string">"/"</span>)
                            ? <span class="hljs-string">""</span>
                            : <span class="hljs-string">"/"</span>;
 </div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>If you want to match &quot;books&quot; and &quot;books/&quot; without creating separate routes, set this
option to &quot;true&quot; and the sub-router will automatically create those routes for you.</p></div></div><div class="code"><div class="wrapper">            <span class="hljs-keyword">var</span> createTrailingSlashRoutes = options &amp;&amp; options.createTrailingSlashRoutes;
 
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.appRoutes) {
 
                <span class="hljs-keyword">if</span> (options &amp;&amp; options.controller) {
                    <span class="hljs-keyword">this</span>.controller = options.controller;
                }
 
                _.each(<span class="hljs-keyword">this</span>.appRoutes, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(callback, path)</span> {</span>
                    <span class="hljs-keyword">if</span> (path) {</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Strip off any leading slashes in the sub-route path,
since we already handle inserting them when needed.</p></div></div><div class="code"><div class="wrapper">                        <span class="hljs-keyword">if</span> (path.substr(<span class="hljs-number">0</span>) === <span class="hljs-string">"/"</span>) {
                            path = path.substr(<span class="hljs-number">1</span>, path.length);
                        }
 
                        routes[prefix + <span class="hljs-keyword">this</span>.separator + path] = callback;
 
                        <span class="hljs-keyword">if</span> (createTrailingSlashRoutes) {
                            routes[prefix + <span class="hljs-keyword">this</span>.separator + path + <span class="hljs-string">"/"</span>] = callback;
                        }
                    } <span class="hljs-keyword">else</span> {</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Default routes (those with a path equal to the empty string)
are simply registered using the prefix as the route path.</p></div></div><div class="code"><div class="wrapper">                        routes[prefix] = callback;
 
                        <span class="hljs-keyword">if</span> (createTrailingSlashRoutes) {
                            routes[prefix + <span class="hljs-string">"/"</span>] = callback;
                        }
                    }
                }, <span class="hljs-keyword">this</span>);
 </div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Override the local sub-routes with the fully-qualified routes that we just set up.</p></div></div><div class="code"><div class="wrapper">                <span class="hljs-keyword">this</span>.appRoutes = routes;
            }
 
            Marionette.AppRouter.prototype.constructor.call(<span class="hljs-keyword">this</span>, options);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>grab the full URL</p></div></div><div class="code"><div class="wrapper">            <span class="hljs-keyword">var</span> hash;
            <span class="hljs-keyword">if</span> (Backbone.history.fragment) {
                hash = Backbone.history.getFragment();
            } <span class="hljs-keyword">else</span> {
                hash = Backbone.history.getHash();
            }

            _.every(<span class="hljs-keyword">this</span>.appRoutes, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(key, route)</span>{</span>
                <span class="hljs-keyword">if</span> (hash.match(Backbone.Router.prototype._routeToRegExp(route))) {
                    Backbone.history.loadUrl(hash);
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                }
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }, <span class="hljs-keyword">this</span>);
        }
    });
 
    <span class="hljs-keyword">return</span> Marionette.SubRouter;
}));</div></div></div></div></body></html>