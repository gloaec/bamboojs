<!DOCTYPE html><html lang="en"><head><title>assets/scripts/vendor/calendar</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../../"><meta name="groc-document-path" content="assets/scripts/vendor/calendar"><meta name="groc-project-path" content="assets/scripts/vendor/calendar.js"><link rel="stylesheet" type="text/css" media="all" href="../../../assets/style.css"><script type="text/javascript" src="../../../assets/behavior.js"></script><body><div id="meta"><div class="file-path">assets/scripts/vendor/calendar.js</div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><p>Bootstrap based calendar full view.</p>
<p><a href="https://github.com/Serhioromano/bootstrap-calendar">https://github.com/Serhioromano/bootstrap-calendar</a></p>
<p>User: Sergey Romanov <a href="&#x6d;&#x61;&#x69;&#x6c;&#x74;&#111;&#x3a;&#115;&#x65;&#114;&#103;&#52;&#49;&#55;&#x32;&#64;&#109;&#x61;&#105;&#x6c;&#x2e;&#114;&#x75;">&#115;&#x65;&#114;&#103;&#52;&#49;&#55;&#x32;&#64;&#109;&#x61;&#105;&#x6c;&#x2e;&#114;&#x75;</a></p></div></div><div class="code"><div class="wrapper"><span class="hljs-pi">"use strict"</span>;

<span class="hljs-built_in">Date</span>.prototype.getWeek = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
	<span class="hljs-keyword">var</span> onejan = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-keyword">this</span>.getFullYear(), <span class="hljs-number">0</span>, <span class="hljs-number">1</span>);
	<span class="hljs-keyword">return</span> <span class="hljs-built_in">Math</span>.ceil((((<span class="hljs-keyword">this</span>.getTime() - onejan.getTime()) / <span class="hljs-number">86400000</span>) + onejan.getDay() + <span class="hljs-number">1</span>) / <span class="hljs-number">7</span>);
};
<span class="hljs-built_in">Date</span>.prototype.getMonthFormatted = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
	<span class="hljs-keyword">var</span> month = <span class="hljs-keyword">this</span>.getMonth() + <span class="hljs-number">1</span>;
	<span class="hljs-keyword">return</span> month &lt; <span class="hljs-number">10</span> ? <span class="hljs-string">'0'</span> + month : month;
};
<span class="hljs-built_in">Date</span>.prototype.getDateFormatted = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
	<span class="hljs-keyword">var</span> date = <span class="hljs-keyword">this</span>.getDate();
	<span class="hljs-keyword">return</span> date &lt; <span class="hljs-number">10</span> ? <span class="hljs-string">'0'</span> + date : date;
};
<span class="hljs-keyword">if</span>(!<span class="hljs-built_in">String</span>.prototype.format) {
	<span class="hljs-built_in">String</span>.prototype.format = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
		<span class="hljs-keyword">var</span> args = <span class="hljs-built_in">arguments</span>;
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.replace(<span class="hljs-regexp">/{(\d+)}/g</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(match, number)</span> {</span>
			<span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> args[number] != <span class="hljs-string">'undefined'</span> ? args[number] : match;
		});
	};
}
<span class="hljs-keyword">if</span>(!<span class="hljs-built_in">String</span>.prototype.formatNum) {
	<span class="hljs-built_in">String</span>.prototype.formatNum = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(decimal)</span> {</span>
		<span class="hljs-keyword">var</span> r = <span class="hljs-string">""</span> + <span class="hljs-keyword">this</span>;
		<span class="hljs-keyword">while</span>(r.length &lt; decimal)
			r = <span class="hljs-string">"0"</span> + r;
		<span class="hljs-keyword">return</span> r;
	};
}

(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($)</span> {</span>

	<span class="hljs-keyword">var</span> defaults = {</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Width of the calendar</p></div></div><div class="code"><div class="wrapper">		width:              <span class="hljs-string">'100%'</span>,</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Initial view (can be &#39;month&#39;, &#39;week&#39;, &#39;day&#39;)</p></div></div><div class="code"><div class="wrapper">		view:               <span class="hljs-string">'month'</span>,</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Initial date. No matter month, week or day this will be a starting point. Can be &#39;now&#39; or a date in format &#39;yyyy-mm-dd&#39;</p></div></div><div class="code"><div class="wrapper">		day:                <span class="hljs-string">'now'</span>,</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Day Start time and end time with time intervals. Time split 10, 15 or 30.</p></div></div><div class="code"><div class="wrapper">		time_start:         <span class="hljs-string">'06:00'</span>,
		time_end:           <span class="hljs-string">'22:00'</span>,
		time_split:         <span class="hljs-string">'30'</span>,</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Source of events data. It can be one of the following:</p>
<ul>
<li>URL to return JSON list of events in special format.
{success:1, result: [....]} or for error {success:0, error:&#39;Something terrible happened&#39;}
events: [...] as described in events property description
The start and end variables will be sent to this url</li>
<li>A function that received the start and end date, and that
returns an array of events (as described in events property description)</li>
<li>An array containing the events</li>
</ul></div></div><div class="code"><div class="wrapper">		events_source:      <span class="hljs-string">''</span>,</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Path to templates should end with slash /. It can be as relative
/component/bootstrap-calendar/tmpls/
or absolute
<a href="http://localhost/component/bootstrap-calendar/tmpls/">http://localhost/component/bootstrap-calendar/tmpls/</a></p></div></div><div class="code"><div class="wrapper">		tmpl_path:          <span class="hljs-string">'tmpls/'</span>,
		tmpl_cache:         <span class="hljs-literal">true</span>,
		classes:            {
			months: {
				inmonth:  <span class="hljs-string">'cal-day-inmonth'</span>,
				outmonth: <span class="hljs-string">'cal-day-outmonth'</span>,
				saturday: <span class="hljs-string">'cal-day-weekend'</span>,
				sunday:   <span class="hljs-string">'cal-day-weekend'</span>,
				holidays: <span class="hljs-string">'cal-day-holiday'</span>,
				today:    <span class="hljs-string">'cal-day-today'</span>
			},
			week:   {
				workday:  <span class="hljs-string">'cal-day-workday'</span>,
				saturday: <span class="hljs-string">'cal-day-weekend'</span>,
				sunday:   <span class="hljs-string">'cal-day-weekend'</span>,
				holidays: <span class="hljs-string">'cal-day-holiday'</span>,
				today:    <span class="hljs-string">'cal-day-today'</span>
			}
		},</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>ID of the element of modal window. If set, events URLs will be opened in modal windows.</p></div></div><div class="code"><div class="wrapper">		modal:              <span class="hljs-literal">null</span>,</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>modal handling setting, one of &quot;iframe&quot;, &quot;ajax&quot; or &quot;template&quot;</p></div></div><div class="code"><div class="wrapper">		modal_type:         <span class="hljs-string">"iframe"</span>,</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>function to set modal title, will be passed the event as a parameter</p></div></div><div class="code"><div class="wrapper">		modal_title:        <span class="hljs-literal">null</span>,
		views:              {
			year:  {
				slide_events: <span class="hljs-number">1</span>,
				enable:       <span class="hljs-number">1</span>
			},
			month: {
				slide_events: <span class="hljs-number">1</span>,
				enable:       <span class="hljs-number">1</span>
			},
			week:  {
				enable: <span class="hljs-number">1</span>
			},
			day:   {
				enable: <span class="hljs-number">1</span>
			}
		},
		merge_holidays:     <span class="hljs-literal">false</span>,</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><hr>
<p>CALLBACKS. Events triggered by calendar class. You can use</p>
<h2 id="those-to-affect-you-ui">those to affect you UI</h2></div></div><div class="code"><div class="wrapper">		onAfterEventsLoad:  <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(events)</span> {</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Inside this function &#39;this&#39; is the calendar instance</p></div></div><div class="code"><div class="wrapper">		},
		onBeforeEventsLoad: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(next)</span> {</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Inside this function &#39;this&#39; is the calendar instance</p></div></div><div class="code"><div class="wrapper">			next();
		},
		onAfterViewLoad:    <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(view)</span> {</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Inside this function &#39;this&#39; is the calendar instance</p></div></div><div class="code"><div class="wrapper">		},
		onAfterModalShown:  <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(events)</span> {</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Inside this function &#39;this&#39; is the calendar instance</p></div></div><div class="code"><div class="wrapper">		},
		onAfterModalHidden: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(events)</span> {</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Inside this function &#39;this&#39; is the calendar instance</p></div></div><div class="code"><div class="wrapper">		},</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><hr>
<h2 id="internal-use-only-do-not-assign-it-will-be-overridden-anyway">INTERNAL USE ONLY. DO NOT ASSIGN IT WILL BE OVERRIDDEN ANYWAY</h2></div></div><div class="code"><div class="wrapper">		events:             [],
		templates:          {
			year:  <span class="hljs-string">''</span>,
			month: <span class="hljs-string">''</span>,
			week:  <span class="hljs-string">''</span>,
			day:   <span class="hljs-string">''</span>
		},
		stop_cycling:       <span class="hljs-literal">false</span>
	};

	<span class="hljs-keyword">var</span> defaults_extended = {
		first_day: <span class="hljs-number">2</span>,
		holidays:  {</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>January 1</p></div></div><div class="code"><div class="wrapper">			<span class="hljs-string">'01-01'</span>:  <span class="hljs-string">"New Year's Day"</span>,</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Third (+3*) Monday (1) in January (01)</p></div></div><div class="code"><div class="wrapper">			<span class="hljs-string">'01+3*1'</span>: <span class="hljs-string">"Birthday of Dr. Martin Luther King, Jr."</span>,</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Third (+3*) Monday (1) in February (02)</p></div></div><div class="code"><div class="wrapper">			<span class="hljs-string">'02+3*1'</span>: <span class="hljs-string">"Washington's Birthday"</span>,</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Last (-1*) Monday (1) in May (05)</p></div></div><div class="code"><div class="wrapper">			<span class="hljs-string">'05-1*1'</span>: <span class="hljs-string">"Memorial Day"</span>,</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>July 4</p></div></div><div class="code"><div class="wrapper">			<span class="hljs-string">'04-07'</span>:  <span class="hljs-string">"Independence Day"</span>,</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>First (+1*) Monday (1) in September (09)</p></div></div><div class="code"><div class="wrapper">			<span class="hljs-string">'09+1*1'</span>: <span class="hljs-string">"Labor Day"</span>,</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Second (+2*) Monday (1) in October (10)</p></div></div><div class="code"><div class="wrapper">			<span class="hljs-string">'10+2*1'</span>: <span class="hljs-string">"Columbus Day"</span>,</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>November 11</p></div></div><div class="code"><div class="wrapper">			<span class="hljs-string">'11-11'</span>:  <span class="hljs-string">"Veterans Day"</span>,</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Fourth (+4*) Thursday (4) in November (11)</p></div></div><div class="code"><div class="wrapper">			<span class="hljs-string">'11+4*4'</span>: <span class="hljs-string">"Thanksgiving Day"</span>,</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>December 25</p></div></div><div class="code"><div class="wrapper">			<span class="hljs-string">'25-12'</span>:  <span class="hljs-string">"Christmas"</span>
		}
	};

	<span class="hljs-keyword">var</span> strings = {
		error_noview:     <span class="hljs-string">'Calendar: View {0} not found'</span>,
		error_dateformat: <span class="hljs-string">'Calendar: Wrong date format {0}. Should be either "now" or "yyyy-mm-dd"'</span>,
		error_loadurl:    <span class="hljs-string">'Calendar: Event URL is not set'</span>,
		error_where:      <span class="hljs-string">'Calendar: Wrong navigation direction {0}. Can be only "next" or "prev" or "today"'</span>,
		error_timedevide: <span class="hljs-string">'Calendar: Time split parameter should divide 60 without decimals. Something like 10, 15, 30'</span>,

		no_events_in_day: <span class="hljs-string">'No events in this day.'</span>,

		title_year:  <span class="hljs-string">'{0}'</span>,
		title_month: <span class="hljs-string">'{0} {1}'</span>,
		title_week:  <span class="hljs-string">'week {0} of {1}'</span>,
		title_day:   <span class="hljs-string">'{0} {1} {2}, {3}'</span>,

		week:        <span class="hljs-string">'Week {0}'</span>,
		all_day:     <span class="hljs-string">'All day'</span>,
		time:        <span class="hljs-string">'Time'</span>,
		events:      <span class="hljs-string">'Events'</span>,
		before_time: <span class="hljs-string">'Ends before timeline'</span>,
		after_time:  <span class="hljs-string">'Starts after timeline'</span>,


		m0:  <span class="hljs-string">'January'</span>,
		m1:  <span class="hljs-string">'February'</span>,
		m2:  <span class="hljs-string">'March'</span>,
		m3:  <span class="hljs-string">'April'</span>,
		m4:  <span class="hljs-string">'May'</span>,
		m5:  <span class="hljs-string">'June'</span>,
		m6:  <span class="hljs-string">'July'</span>,
		m7:  <span class="hljs-string">'August'</span>,
		m8:  <span class="hljs-string">'September'</span>,
		m9:  <span class="hljs-string">'October'</span>,
		m10: <span class="hljs-string">'November'</span>,
		m11: <span class="hljs-string">'December'</span>,

		ms0:  <span class="hljs-string">'Jan'</span>,
		ms1:  <span class="hljs-string">'Feb'</span>,
		ms2:  <span class="hljs-string">'Mar'</span>,
		ms3:  <span class="hljs-string">'Apr'</span>,
		ms4:  <span class="hljs-string">'May'</span>,
		ms5:  <span class="hljs-string">'Jun'</span>,
		ms6:  <span class="hljs-string">'Jul'</span>,
		ms7:  <span class="hljs-string">'Aug'</span>,
		ms8:  <span class="hljs-string">'Sep'</span>,
		ms9:  <span class="hljs-string">'Oct'</span>,
		ms10: <span class="hljs-string">'Nov'</span>,
		ms11: <span class="hljs-string">'Dec'</span>,

		d0: <span class="hljs-string">'Sunday'</span>,
		d1: <span class="hljs-string">'Monday'</span>,
		d2: <span class="hljs-string">'Tuesday'</span>,
		d3: <span class="hljs-string">'Wednesday'</span>,
		d4: <span class="hljs-string">'Thursday'</span>,
		d5: <span class="hljs-string">'Friday'</span>,
		d6: <span class="hljs-string">'Saturday'</span>
	};

	<span class="hljs-keyword">var</span> browser_timezone = <span class="hljs-string">''</span>;
	<span class="hljs-keyword">try</span> {
		<span class="hljs-keyword">if</span>($.type(window.jstz) == <span class="hljs-string">'object'</span> &amp;&amp; $.type(jstz.determine) == <span class="hljs-string">'function'</span>) {
			browser_timezone = jstz.determine().name();
			<span class="hljs-keyword">if</span>($.type(browser_timezone) !== <span class="hljs-string">'string'</span>) {
				browser_timezone = <span class="hljs-string">''</span>;
			}
		}
	}
	<span class="hljs-keyword">catch</span>(e) {
	}

	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">buildEventsUrl</span><span class="hljs-params">(events_url, data)</span> {</span>
		<span class="hljs-keyword">var</span> separator, key, url;
		url = events_url;
		separator = (events_url.indexOf(<span class="hljs-string">'?'</span>) &lt; <span class="hljs-number">0</span>) ? <span class="hljs-string">'?'</span> : <span class="hljs-string">'&amp;'</span>;
		<span class="hljs-keyword">for</span>(key <span class="hljs-keyword">in</span> data) {
			url += separator + key + <span class="hljs-string">'='</span> + <span class="hljs-built_in">encodeURIComponent</span>(data[key]);
			separator = <span class="hljs-string">'&amp;'</span>;
		}
		<span class="hljs-keyword">return</span> url;
	}

	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getExtentedOption</span><span class="hljs-params">(cal, option_name)</span> {</span>
		<span class="hljs-keyword">var</span> fromOptions = (cal.options[option_name] != <span class="hljs-literal">null</span>) ? cal.options[option_name] : <span class="hljs-literal">null</span>;
		<span class="hljs-keyword">var</span> fromLanguage = (cal.locale[option_name] != <span class="hljs-literal">null</span>) ? cal.locale[option_name] : <span class="hljs-literal">null</span>;
		<span class="hljs-keyword">if</span>((option_name == <span class="hljs-string">'holidays'</span>) &amp;&amp; cal.options.merge_holidays) {
			<span class="hljs-keyword">var</span> holidays = {};
			$.extend(<span class="hljs-literal">true</span>, holidays, fromLanguage ? fromLanguage : defaults_extended.holidays);
			<span class="hljs-keyword">if</span>(fromOptions) {
				$.extend(<span class="hljs-literal">true</span>, holidays, fromOptions);
			}
			<span class="hljs-keyword">return</span> holidays;
		}
		<span class="hljs-keyword">else</span> {
			<span class="hljs-keyword">if</span>(fromOptions != <span class="hljs-literal">null</span>) {
				<span class="hljs-keyword">return</span> fromOptions;
			}
			<span class="hljs-keyword">if</span>(fromLanguage != <span class="hljs-literal">null</span>) {
				<span class="hljs-keyword">return</span> fromLanguage;
			}
			<span class="hljs-keyword">return</span> defaults_extended[option_name];
		}
	}

	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getHolidays</span><span class="hljs-params">(cal, year)</span> {</span>
		<span class="hljs-keyword">var</span> hash = [];
		<span class="hljs-keyword">var</span> holidays_def = getExtentedOption(cal, <span class="hljs-string">'holidays'</span>);
		<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> k <span class="hljs-keyword">in</span> holidays_def) {
			hash.push(k + <span class="hljs-string">':'</span> + holidays_def[k]);
		}
		hash.push(year);
		hash = hash.join(<span class="hljs-string">'|'</span>);
		<span class="hljs-keyword">if</span>(hash <span class="hljs-keyword">in</span> getHolidays.cache) {
			<span class="hljs-keyword">return</span> getHolidays.cache[hash];
		}
		<span class="hljs-keyword">var</span> holidays = [];
		$.each(holidays_def, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(key, name)</span> {</span>
			<span class="hljs-keyword">var</span> firstDay = <span class="hljs-literal">null</span>, lastDay = <span class="hljs-literal">null</span>, failed = <span class="hljs-literal">false</span>;
			$.each(key.split(<span class="hljs-string">'&gt;'</span>), <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(i, chunk)</span> {</span>
				<span class="hljs-keyword">var</span> m, date = <span class="hljs-literal">null</span>;
				<span class="hljs-keyword">if</span>(m = <span class="hljs-regexp">/^(\d\d)-(\d\d)$/</span>.exec(chunk)) {
					date = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(year, <span class="hljs-built_in">parseInt</span>(m[<span class="hljs-number">2</span>], <span class="hljs-number">10</span>) - <span class="hljs-number">1</span>, <span class="hljs-built_in">parseInt</span>(m[<span class="hljs-number">1</span>], <span class="hljs-number">10</span>));
				}
				<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(m = <span class="hljs-regexp">/^(\d\d)-(\d\d)-(\d\d\d\d)$/</span>.exec(chunk)) {
					<span class="hljs-keyword">if</span>(<span class="hljs-built_in">parseInt</span>(m[<span class="hljs-number">3</span>], <span class="hljs-number">10</span>) == year) {
						date = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(year, <span class="hljs-built_in">parseInt</span>(m[<span class="hljs-number">2</span>], <span class="hljs-number">10</span>) - <span class="hljs-number">1</span>, <span class="hljs-built_in">parseInt</span>(m[<span class="hljs-number">1</span>], <span class="hljs-number">10</span>));
					}
				}
				<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(m = <span class="hljs-regexp">/^easter(([+\-])(\d+))?$/</span>.exec(chunk)) {
					date = getEasterDate(year, m[<span class="hljs-number">1</span>] ? <span class="hljs-built_in">parseInt</span>(m[<span class="hljs-number">1</span>], <span class="hljs-number">10</span>) : <span class="hljs-number">0</span>);
				}
				<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(m = <span class="hljs-regexp">/^(\d\d)([+\-])([1-5])\*([0-6])$/</span>.exec(chunk)) {
					<span class="hljs-keyword">var</span> month = <span class="hljs-built_in">parseInt</span>(m[<span class="hljs-number">1</span>], <span class="hljs-number">10</span>) - <span class="hljs-number">1</span>;
					<span class="hljs-keyword">var</span> direction = m[<span class="hljs-number">2</span>];
					<span class="hljs-keyword">var</span> offset = <span class="hljs-built_in">parseInt</span>(m[<span class="hljs-number">3</span>]);
					<span class="hljs-keyword">var</span> weekday = <span class="hljs-built_in">parseInt</span>(m[<span class="hljs-number">4</span>]);
					<span class="hljs-keyword">switch</span>(direction) {
						<span class="hljs-keyword">case</span> <span class="hljs-string">'+'</span>:
							<span class="hljs-keyword">var</span> d = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(year, month, <span class="hljs-number">1</span> - <span class="hljs-number">7</span>);
							<span class="hljs-keyword">while</span>(d.getDay() != weekday) {
								d = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(d.getFullYear(), d.getMonth(), d.getDate() + <span class="hljs-number">1</span>);
							}
							date = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(d.getFullYear(), d.getMonth(), d.getDate() + <span class="hljs-number">7</span> * offset);
							<span class="hljs-keyword">break</span>;
						<span class="hljs-keyword">case</span> <span class="hljs-string">'-'</span>:
							<span class="hljs-keyword">var</span> d = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(year, month + <span class="hljs-number">1</span>, <span class="hljs-number">0</span> + <span class="hljs-number">7</span>);
							<span class="hljs-keyword">while</span>(d.getDay() != weekday) {
								d = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(d.getFullYear(), d.getMonth(), d.getDate() - <span class="hljs-number">1</span>);
							}
							date = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(d.getFullYear(), d.getMonth(), d.getDate() - <span class="hljs-number">7</span> * offset);
							<span class="hljs-keyword">break</span>;
					}
				}
				<span class="hljs-keyword">if</span>(!date) {
					warn(<span class="hljs-string">'Unknown holiday: '</span> + key);
					failed = <span class="hljs-literal">true</span>;
					<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
				}
				<span class="hljs-keyword">switch</span>(i) {
					<span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:
						firstDay = date;
						<span class="hljs-keyword">break</span>;
					<span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:
						<span class="hljs-keyword">if</span>(date.getTime() &lt;= firstDay.getTime()) {
							warn(<span class="hljs-string">'Unknown holiday: '</span> + key);
							failed = <span class="hljs-literal">true</span>;
							<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
						}
						lastDay = date;
						<span class="hljs-keyword">break</span>;
					<span class="hljs-keyword">default</span>:
						warn(<span class="hljs-string">'Unknown holiday: '</span> + key);
						failed = <span class="hljs-literal">true</span>;
						<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
				}
			});
			<span class="hljs-keyword">if</span>(!failed) {
				<span class="hljs-keyword">var</span> days = [];
				<span class="hljs-keyword">if</span>(lastDay) {
					<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> date = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(firstDay.getTime()); date.getTime() &lt;= lastDay.getTime(); date.setDate(date.getDate() + <span class="hljs-number">1</span>)) {
						days.push(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(date.getTime()));
					}
				}
				<span class="hljs-keyword">else</span> {
					days.push(firstDay);
				}
				holidays.push({name: name, days: days});
			}
		});
		getHolidays.cache[hash] = holidays;
		<span class="hljs-keyword">return</span> getHolidays.cache[hash];
	}

	getHolidays.cache = {};

	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">warn</span><span class="hljs-params">(message)</span> {</span>
		<span class="hljs-keyword">if</span>($.type(window.console) == <span class="hljs-string">'object'</span> &amp;&amp; $.type(window.console.warn) == <span class="hljs-string">'function'</span>) {
			window.console.warn(<span class="hljs-string">'[Bootstrap-Calendar] '</span> + message);
		}
	}

	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Calendar</span><span class="hljs-params">(params, context)</span> {</span>
		<span class="hljs-keyword">this</span>.options = $.extend(<span class="hljs-literal">true</span>, {position: {start: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(), end: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()}}, defaults, params);
		<span class="hljs-keyword">this</span>.setLanguage(<span class="hljs-keyword">this</span>.options.language);
		<span class="hljs-keyword">this</span>.context = context;

		context.css(<span class="hljs-string">'width'</span>, <span class="hljs-keyword">this</span>.options.width).addClass(<span class="hljs-string">'cal-context'</span>);

		<span class="hljs-keyword">this</span>.view();
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
	}

	Calendar.prototype.setOptions = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(object)</span> {</span>
		$.extend(<span class="hljs-keyword">this</span>.options, object);
		<span class="hljs-keyword">if</span>(<span class="hljs-string">'language'</span> <span class="hljs-keyword">in</span> object) {
			<span class="hljs-keyword">this</span>.setLanguage(object.language);
		}
		<span class="hljs-keyword">if</span>(<span class="hljs-string">'modal'</span> <span class="hljs-keyword">in</span> object) {
			<span class="hljs-keyword">this</span>._update_modal();
		}
	}

	Calendar.prototype.setLanguage = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(lang)</span> {</span>
		<span class="hljs-keyword">if</span>(window.calendar_languages &amp;&amp; (lang <span class="hljs-keyword">in</span> window.calendar_languages)) {
			<span class="hljs-keyword">this</span>.locale = $.extend(<span class="hljs-literal">true</span>, {}, strings, calendar_languages[lang]);
			<span class="hljs-keyword">this</span>.options.language = lang;
		} <span class="hljs-keyword">else</span> {
			<span class="hljs-keyword">this</span>.locale = strings;
			<span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.options.language;
		}
	}

	Calendar.prototype._render = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
		<span class="hljs-keyword">this</span>.context.html(<span class="hljs-string">''</span>);
		<span class="hljs-keyword">this</span>._loadTemplate(<span class="hljs-keyword">this</span>.options.view);
		<span class="hljs-keyword">this</span>.stop_cycling = <span class="hljs-literal">false</span>;

		<span class="hljs-keyword">var</span> data = {};
		data.cal = <span class="hljs-keyword">this</span>;
		data.day = <span class="hljs-number">1</span>;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Getting list of days in a week in correct order. Works for month and week views</p></div></div><div class="code"><div class="wrapper">		<span class="hljs-keyword">if</span>(getExtentedOption(<span class="hljs-keyword">this</span>, <span class="hljs-string">'first_day'</span>) == <span class="hljs-number">1</span>) {
			data.days_name = [<span class="hljs-keyword">this</span>.locale.d1, <span class="hljs-keyword">this</span>.locale.d2, <span class="hljs-keyword">this</span>.locale.d3, <span class="hljs-keyword">this</span>.locale.d4, <span class="hljs-keyword">this</span>.locale.d5, <span class="hljs-keyword">this</span>.locale.d6, <span class="hljs-keyword">this</span>.locale.d0]
		} <span class="hljs-keyword">else</span> {
			data.days_name = [<span class="hljs-keyword">this</span>.locale.d0, <span class="hljs-keyword">this</span>.locale.d1, <span class="hljs-keyword">this</span>.locale.d2, <span class="hljs-keyword">this</span>.locale.d3, <span class="hljs-keyword">this</span>.locale.d4, <span class="hljs-keyword">this</span>.locale.d5, <span class="hljs-keyword">this</span>.locale.d6]
		}</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Get all events between start and end</p></div></div><div class="code"><div class="wrapper">		<span class="hljs-keyword">var</span> start = <span class="hljs-built_in">parseInt</span>(<span class="hljs-keyword">this</span>.options.position.start.getTime());
		<span class="hljs-keyword">var</span> end = <span class="hljs-built_in">parseInt</span>(<span class="hljs-keyword">this</span>.options.position.end.getTime());

		data.events = <span class="hljs-keyword">this</span>.getEventsBetween(start, end);

		<span class="hljs-keyword">switch</span>(<span class="hljs-keyword">this</span>.options.view) {
			<span class="hljs-keyword">case</span> <span class="hljs-string">'month'</span>:
				<span class="hljs-keyword">break</span>;
			<span class="hljs-keyword">case</span> <span class="hljs-string">'week'</span>:
				<span class="hljs-keyword">this</span>._calculate_hour_minutes(data);
				<span class="hljs-keyword">break</span>;
			<span class="hljs-keyword">case</span> <span class="hljs-string">'day'</span>:
				<span class="hljs-keyword">this</span>._calculate_hour_minutes(data);
				<span class="hljs-keyword">break</span>;
		}

		data.start = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-keyword">this</span>.options.position.start.getTime());
		data.lang = <span class="hljs-keyword">this</span>.locale;

		<span class="hljs-keyword">this</span>.context.append(<span class="hljs-keyword">this</span>.options.templates[<span class="hljs-keyword">this</span>.options.view](data));
		<span class="hljs-keyword">this</span>._update();
	};

	Calendar.prototype._calculate_hour_minutes = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span> {</span>
		<span class="hljs-keyword">var</span> $self = <span class="hljs-keyword">this</span>;
		<span class="hljs-keyword">var</span> time_split = <span class="hljs-built_in">parseInt</span>(<span class="hljs-keyword">this</span>.options.time_split);
		<span class="hljs-keyword">var</span> time_split_count = <span class="hljs-number">60</span> / time_split;
		<span class="hljs-keyword">var</span> time_split_hour = <span class="hljs-built_in">Math</span>.min(time_split_count, <span class="hljs-number">1</span>);

		<span class="hljs-keyword">if</span>(((time_split_count &gt;= <span class="hljs-number">1</span>) &amp;&amp; (time_split_count % <span class="hljs-number">1</span> != <span class="hljs-number">0</span>)) || ((time_split_count &lt; <span class="hljs-number">1</span>) &amp;&amp; (<span class="hljs-number">1440</span> / time_split % <span class="hljs-number">1</span> != <span class="hljs-number">0</span>))) {
			$.error(<span class="hljs-keyword">this</span>.locale.error_timedevide);
		}

		<span class="hljs-keyword">var</span> time_start = <span class="hljs-keyword">this</span>.options.time_start.split(<span class="hljs-string">":"</span>);
		<span class="hljs-keyword">var</span> time_end = <span class="hljs-keyword">this</span>.options.time_end.split(<span class="hljs-string">":"</span>);

		data.hours = (<span class="hljs-built_in">parseInt</span>(time_end[<span class="hljs-number">0</span>]) - <span class="hljs-built_in">parseInt</span>(time_start[<span class="hljs-number">0</span>])) * time_split_hour;
		<span class="hljs-keyword">var</span> lines = data.hours * time_split_count - <span class="hljs-built_in">parseInt</span>(time_start[<span class="hljs-number">1</span>]) / time_split;
		<span class="hljs-keyword">var</span> ms_per_line = (<span class="hljs-number">60000</span> * time_split);

		<span class="hljs-keyword">var</span> start = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-keyword">this</span>.options.position.start.getTime());
		start.setHours(time_start[<span class="hljs-number">0</span>]);
		start.setMinutes(time_start[<span class="hljs-number">1</span>]);
		<span class="hljs-keyword">var</span> end = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-keyword">this</span>.options.position.end.getTime());
		end.setHours(time_end[<span class="hljs-number">0</span>]);
		end.setMinutes(time_end[<span class="hljs-number">1</span>]);

		data.all_day = [];
		data.by_hour = [];
		data.after_time = [];
		data.before_time = [];
		$.each(data.events, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(k, e)</span> {</span>
			<span class="hljs-keyword">var</span> s = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-built_in">parseInt</span>(e.start));
			<span class="hljs-keyword">var</span> f = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-built_in">parseInt</span>(e.end));

			e.start_hour = s.getHours().toString().formatNum(<span class="hljs-number">2</span>) + <span class="hljs-string">':'</span> + s.getMinutes().toString().formatNum(<span class="hljs-number">2</span>);
			e.end_hour = f.getHours().toString().formatNum(<span class="hljs-number">2</span>) + <span class="hljs-string">':'</span> + f.getMinutes().toString().formatNum(<span class="hljs-number">2</span>);

			<span class="hljs-keyword">if</span>(e.start &lt; start.getTime()) {
				warn(<span class="hljs-number">1</span>);
				e.start_hour = s.getDate() + <span class="hljs-string">' '</span> + $self.locale[<span class="hljs-string">'ms'</span> + s.getMonth()] + <span class="hljs-string">' '</span> + e.start_hour;
			}

			<span class="hljs-keyword">if</span>(e.end &gt; end.getTime()) {
				warn(<span class="hljs-number">1</span>);
				e.end_hour = f.getDate() + <span class="hljs-string">' '</span> + $self.locale[<span class="hljs-string">'ms'</span> + f.getMonth()] + <span class="hljs-string">' '</span> + e.end_hour;
			}

			<span class="hljs-keyword">if</span>(e.start &lt; start.getTime() &amp;&amp; e.end &gt; end.getTime()) {
				data.all_day.push(e);
				<span class="hljs-keyword">return</span>;
			}

			<span class="hljs-keyword">if</span>(e.end &lt; start.getTime()) {
				data.before_time.push(e);
				<span class="hljs-keyword">return</span>;
			}

			<span class="hljs-keyword">if</span>(e.start &gt; end.getTime()) {
				data.after_time.push(e);
				<span class="hljs-keyword">return</span>;
			}

			<span class="hljs-keyword">var</span> event_start = start.getTime() - e.start;

			<span class="hljs-keyword">if</span>(event_start &gt;= <span class="hljs-number">0</span>) {
				e.top = <span class="hljs-number">0</span>;
			} <span class="hljs-keyword">else</span> {
				e.top = <span class="hljs-built_in">Math</span>.abs(event_start) / ms_per_line;
			}

			<span class="hljs-keyword">var</span> lines_left = <span class="hljs-built_in">Math</span>.abs(lines - e.top);
			<span class="hljs-keyword">var</span> lines_in_event = (e.end - e.start) / ms_per_line;
			<span class="hljs-keyword">if</span>(event_start &gt;= <span class="hljs-number">0</span>) {
				lines_in_event = (e.end - start.getTime()) / ms_per_line;
			}


			e.lines = lines_in_event;
			<span class="hljs-keyword">if</span>(lines_in_event &gt; lines_left) {
				e.lines = lines_left;
			}

			data.by_hour.push(e);
		});

		<span class="hljs-comment">//var d = new Date('2013-03-14 13:20:00');</span>
		<span class="hljs-comment">//warn(d.getTime());</span>
	};

	Calendar.prototype._hour_min = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(hour)</span> {</span>
		<span class="hljs-keyword">var</span> time_start = <span class="hljs-keyword">this</span>.options.time_start.split(<span class="hljs-string">":"</span>);
		<span class="hljs-keyword">var</span> time_split = <span class="hljs-built_in">parseInt</span>(<span class="hljs-keyword">this</span>.options.time_split);
		<span class="hljs-keyword">var</span> in_hour = <span class="hljs-number">60</span> / time_split;
		<span class="hljs-keyword">return</span> (hour == <span class="hljs-number">0</span>) ? (in_hour - (<span class="hljs-built_in">parseInt</span>(time_start[<span class="hljs-number">1</span>]) / time_split)) : in_hour;
	};

	Calendar.prototype._hour = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(hour, part)</span> {</span>
		<span class="hljs-keyword">var</span> time_start = <span class="hljs-keyword">this</span>.options.time_start.split(<span class="hljs-string">":"</span>);
		<span class="hljs-keyword">var</span> time_split = <span class="hljs-built_in">parseInt</span>(<span class="hljs-keyword">this</span>.options.time_split);
		<span class="hljs-keyword">var</span> h = <span class="hljs-string">""</span> + (<span class="hljs-built_in">parseInt</span>(time_start[<span class="hljs-number">0</span>]) + hour * <span class="hljs-built_in">Math</span>.max(time_split / <span class="hljs-number">60</span>, <span class="hljs-number">1</span>));
		<span class="hljs-keyword">var</span> m = <span class="hljs-string">""</span> + (time_split * part + ((hour == <span class="hljs-number">0</span>) ? <span class="hljs-built_in">parseInt</span>(time_start[<span class="hljs-number">1</span>]) : <span class="hljs-number">0</span>));

		<span class="hljs-keyword">return</span> h.formatNum(<span class="hljs-number">2</span>) + <span class="hljs-string">":"</span> + m.formatNum(<span class="hljs-number">2</span>);
	};

	Calendar.prototype._week = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(event)</span> {</span>
		<span class="hljs-keyword">this</span>._loadTemplate(<span class="hljs-string">'week-days'</span>);

		<span class="hljs-keyword">var</span> t = {};
		<span class="hljs-keyword">var</span> start = <span class="hljs-built_in">parseInt</span>(<span class="hljs-keyword">this</span>.options.position.start.getTime());
		<span class="hljs-keyword">var</span> end = <span class="hljs-built_in">parseInt</span>(<span class="hljs-keyword">this</span>.options.position.end.getTime());
		<span class="hljs-keyword">var</span> events = [];
		<span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
		<span class="hljs-keyword">var</span> first_day = getExtentedOption(<span class="hljs-keyword">this</span>, <span class="hljs-string">'first_day'</span>);

		$.each(<span class="hljs-keyword">this</span>.getEventsBetween(start, end), <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(k, event)</span> {</span>
			event.start_day = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-built_in">parseInt</span>(event.start)).getDay();
			<span class="hljs-keyword">if</span>(first_day == <span class="hljs-number">1</span>) {
				event.start_day = (event.start_day + <span class="hljs-number">6</span>) % <span class="hljs-number">7</span>;
			}
			<span class="hljs-keyword">if</span>((event.end - event.start) &lt;= <span class="hljs-number">86400000</span>) {
				event.days = <span class="hljs-number">1</span>;
			} <span class="hljs-keyword">else</span> {
				event.days = ((event.end - event.start) / <span class="hljs-number">86400000</span>);
			}

			<span class="hljs-keyword">if</span>(event.start &lt; start) {

				event.days = event.days - ((start - event.start) / <span class="hljs-number">86400000</span>);
				event.start_day = <span class="hljs-number">0</span>;
			}

			event.days = <span class="hljs-built_in">Math</span>.ceil(event.days);

			<span class="hljs-keyword">if</span>(event.start_day + event.days &gt; <span class="hljs-number">7</span>) {
				event.days = <span class="hljs-number">7</span> - (event.start_day);
			}

			events.push(event);
		});
		t.events = events;
		t.cal = <span class="hljs-keyword">this</span>;
		<span class="hljs-keyword">return</span> self.options.templates[<span class="hljs-string">'week-days'</span>](t);
	}

	Calendar.prototype._month = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(month)</span> {</span>
		<span class="hljs-keyword">this</span>._loadTemplate(<span class="hljs-string">'year-month'</span>);

		<span class="hljs-keyword">var</span> t = {cal: <span class="hljs-keyword">this</span>};
		<span class="hljs-keyword">var</span> newmonth = month + <span class="hljs-number">1</span>;
		t.data_day = <span class="hljs-keyword">this</span>.options.position.start.getFullYear() + <span class="hljs-string">'-'</span> + (newmonth &lt; <span class="hljs-number">10</span> ? <span class="hljs-string">'0'</span> + newmonth : newmonth) + <span class="hljs-string">'-'</span> + <span class="hljs-string">'01'</span>;
		t.month_name = <span class="hljs-keyword">this</span>.locale[<span class="hljs-string">'m'</span> + month];

		<span class="hljs-keyword">var</span> curdate = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-keyword">this</span>.options.position.start.getFullYear(), month, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
		t.start = <span class="hljs-built_in">parseInt</span>(curdate.getTime());
		t.end = <span class="hljs-built_in">parseInt</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-keyword">this</span>.options.position.start.getFullYear(), month + <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>).getTime());
		t.events = <span class="hljs-keyword">this</span>.getEventsBetween(t.start, t.end);
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.options.templates[<span class="hljs-string">'year-month'</span>](t);
	}

	Calendar.prototype._day = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(week, day)</span> {</span>
		<span class="hljs-keyword">this</span>._loadTemplate(<span class="hljs-string">'month-day'</span>);

		<span class="hljs-keyword">var</span> t = {tooltip: <span class="hljs-string">''</span>, cal: <span class="hljs-keyword">this</span>};
		<span class="hljs-keyword">var</span> cls = <span class="hljs-keyword">this</span>.options.classes.months.outmonth;

		<span class="hljs-keyword">var</span> firstday = <span class="hljs-keyword">this</span>.options.position.start.getDay();
		<span class="hljs-keyword">if</span>(getExtentedOption(<span class="hljs-keyword">this</span>, <span class="hljs-string">'first_day'</span>) == <span class="hljs-number">2</span>) {
			firstday++;
		} <span class="hljs-keyword">else</span> {
			firstday = (firstday == <span class="hljs-number">0</span> ? <span class="hljs-number">7</span> : firstday);
		}

		day = (day - firstday) + <span class="hljs-number">1</span>;
		<span class="hljs-keyword">var</span> curdate = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-keyword">this</span>.options.position.start.getFullYear(), <span class="hljs-keyword">this</span>.options.position.start.getMonth(), day, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>if day of the current month</p></div></div><div class="code"><div class="wrapper">		<span class="hljs-keyword">if</span>(day &gt; <span class="hljs-number">0</span>) {
			cls = <span class="hljs-keyword">this</span>.options.classes.months.inmonth;
		}</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>stop cycling table rows;</p></div></div><div class="code"><div class="wrapper">		<span class="hljs-keyword">var</span> daysinmonth = (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-keyword">this</span>.options.position.end.getTime() - <span class="hljs-number">1</span>)).getDate();
		<span class="hljs-keyword">if</span>((day + <span class="hljs-number">1</span>) &gt; daysinmonth) {
			<span class="hljs-keyword">this</span>.stop_cycling = <span class="hljs-literal">true</span>;
		}</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>if day of the next month</p></div></div><div class="code"><div class="wrapper">		<span class="hljs-keyword">if</span>(day &gt; daysinmonth) {
			day = day - daysinmonth;
			cls = <span class="hljs-keyword">this</span>.options.classes.months.outmonth;
		}

		cls = $.trim(cls + <span class="hljs-string">" "</span> + <span class="hljs-keyword">this</span>._getDayClass(<span class="hljs-string">"months"</span>, curdate));

		<span class="hljs-keyword">if</span>(day &lt;= <span class="hljs-number">0</span>) {
			<span class="hljs-keyword">var</span> daysinprevmonth = (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-keyword">this</span>.options.position.start.getFullYear(), <span class="hljs-keyword">this</span>.options.position.start.getMonth(), <span class="hljs-number">0</span>)).getDate();
			day = daysinprevmonth - <span class="hljs-built_in">Math</span>.abs(day);
			cls += <span class="hljs-string">' cal-month-first-row'</span>;
		}

		<span class="hljs-keyword">var</span> holiday = <span class="hljs-keyword">this</span>._getHoliday(curdate);
		<span class="hljs-keyword">if</span>(holiday !== <span class="hljs-literal">false</span>) {
			t.tooltip = holiday;
		}

		t.data_day = curdate.getFullYear() + <span class="hljs-string">'-'</span> + curdate.getMonthFormatted() + <span class="hljs-string">'-'</span> + (day &lt; <span class="hljs-number">10</span> ? <span class="hljs-string">'0'</span> + day : day);
		t.cls = cls;
		t.day = day;

		t.start = <span class="hljs-built_in">parseInt</span>(curdate.getTime());
		t.end = <span class="hljs-built_in">parseInt</span>(t.start + <span class="hljs-number">86400000</span>);
		t.events = <span class="hljs-keyword">this</span>.getEventsBetween(t.start, t.end);
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.options.templates[<span class="hljs-string">'month-day'</span>](t);
	}

	Calendar.prototype._getHoliday = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(date)</span> {</span>
		<span class="hljs-keyword">var</span> result = <span class="hljs-literal">false</span>;
		$.each(getHolidays(<span class="hljs-keyword">this</span>, date.getFullYear()), <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
			<span class="hljs-keyword">var</span> found = <span class="hljs-literal">false</span>;
			$.each(<span class="hljs-keyword">this</span>.days, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
				<span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.toDateString() == date.toDateString()) {
					found = <span class="hljs-literal">true</span>;
					<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
				}
			});
			<span class="hljs-keyword">if</span>(found) {
				result = <span class="hljs-keyword">this</span>.name;
				<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
			}
		});
		<span class="hljs-keyword">return</span> result;
	};

	Calendar.prototype._getHolidayName = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(date)</span> {</span>
		<span class="hljs-keyword">var</span> holiday = <span class="hljs-keyword">this</span>._getHoliday(date);
		<span class="hljs-keyword">return</span> (holiday === <span class="hljs-literal">false</span>) ? <span class="hljs-string">""</span> : holiday;
	};

	Calendar.prototype._getDayClass = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(class_group, date)</span> {</span>
		<span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
		<span class="hljs-keyword">var</span> addClass = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(which, to)</span> {</span>
			<span class="hljs-keyword">var</span> cls;
			cls = (self.options.classes &amp;&amp; (class_group <span class="hljs-keyword">in</span> self.options.classes) &amp;&amp; (which <span class="hljs-keyword">in</span> self.options.classes[class_group])) ? self.options.classes[class_group][which] : <span class="hljs-string">""</span>;
			<span class="hljs-keyword">if</span>((<span class="hljs-keyword">typeof</span>(cls) == <span class="hljs-string">"string"</span>) &amp;&amp; cls.length) {
				to.push(cls);
			}
		};
		<span class="hljs-keyword">var</span> classes = [];
		<span class="hljs-keyword">if</span>(date.toDateString() == (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()).toDateString()) {
			addClass(<span class="hljs-string">"today"</span>, classes);
		}
		<span class="hljs-keyword">var</span> holiday = <span class="hljs-keyword">this</span>._getHoliday(date);
		<span class="hljs-keyword">if</span>(holiday !== <span class="hljs-literal">false</span>) {
			addClass(<span class="hljs-string">"holidays"</span>, classes);
		}
		<span class="hljs-keyword">switch</span>(date.getDay()) {
			<span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:
				addClass(<span class="hljs-string">"sunday"</span>, classes);
				<span class="hljs-keyword">break</span>;
			<span class="hljs-keyword">case</span> <span class="hljs-number">6</span>:
				addClass(<span class="hljs-string">"saturday"</span>, classes);
				<span class="hljs-keyword">break</span>;
		}

		addClass(date.toDateString(), classes);

		<span class="hljs-keyword">return</span> classes.join(<span class="hljs-string">" "</span>);
	};

	Calendar.prototype.view = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(view)</span> {</span>
		<span class="hljs-keyword">if</span>(view) {
			<span class="hljs-keyword">if</span>(!<span class="hljs-keyword">this</span>.options.views[view].enable) {
				<span class="hljs-keyword">return</span>;
			}
			<span class="hljs-keyword">this</span>.options.view = view;
		}


		<span class="hljs-keyword">this</span>._init_position();
		<span class="hljs-keyword">this</span>._loadEvents();
		<span class="hljs-keyword">this</span>._render();

		<span class="hljs-keyword">this</span>.options.onAfterViewLoad.call(<span class="hljs-keyword">this</span>, <span class="hljs-keyword">this</span>.options.view);
	};

	Calendar.prototype.navigate = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(where, next)</span> {</span>
		<span class="hljs-keyword">var</span> to = $.extend({}, <span class="hljs-keyword">this</span>.options.position);
		<span class="hljs-keyword">if</span>(where == <span class="hljs-string">'next'</span>) {
			<span class="hljs-keyword">switch</span>(<span class="hljs-keyword">this</span>.options.view) {
				<span class="hljs-keyword">case</span> <span class="hljs-string">'year'</span>:
					to.start.setFullYear(<span class="hljs-keyword">this</span>.options.position.start.getFullYear() + <span class="hljs-number">1</span>);
					<span class="hljs-keyword">break</span>;
				<span class="hljs-keyword">case</span> <span class="hljs-string">'month'</span>:
					to.start.setMonth(<span class="hljs-keyword">this</span>.options.position.start.getMonth() + <span class="hljs-number">1</span>);
					<span class="hljs-keyword">break</span>;
				<span class="hljs-keyword">case</span> <span class="hljs-string">'week'</span>:
					to.start.setDate(<span class="hljs-keyword">this</span>.options.position.start.getDate() + <span class="hljs-number">7</span>);
					<span class="hljs-keyword">break</span>;
				<span class="hljs-keyword">case</span> <span class="hljs-string">'day'</span>:
					to.start.setDate(<span class="hljs-keyword">this</span>.options.position.start.getDate() + <span class="hljs-number">1</span>);
					<span class="hljs-keyword">break</span>;
			}
		} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(where == <span class="hljs-string">'prev'</span>) {
			<span class="hljs-keyword">switch</span>(<span class="hljs-keyword">this</span>.options.view) {
				<span class="hljs-keyword">case</span> <span class="hljs-string">'year'</span>:
					to.start.setFullYear(<span class="hljs-keyword">this</span>.options.position.start.getFullYear() - <span class="hljs-number">1</span>);
					<span class="hljs-keyword">break</span>;
				<span class="hljs-keyword">case</span> <span class="hljs-string">'month'</span>:
					to.start.setMonth(<span class="hljs-keyword">this</span>.options.position.start.getMonth() - <span class="hljs-number">1</span>);
					<span class="hljs-keyword">break</span>;
				<span class="hljs-keyword">case</span> <span class="hljs-string">'week'</span>:
					to.start.setDate(<span class="hljs-keyword">this</span>.options.position.start.getDate() - <span class="hljs-number">7</span>);
					<span class="hljs-keyword">break</span>;
				<span class="hljs-keyword">case</span> <span class="hljs-string">'day'</span>:
					to.start.setDate(<span class="hljs-keyword">this</span>.options.position.start.getDate() - <span class="hljs-number">1</span>);
					<span class="hljs-keyword">break</span>;
			}
		} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(where == <span class="hljs-string">'today'</span>) {
			to.start.setTime(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime());
		}
		<span class="hljs-keyword">else</span> {
			$.error(<span class="hljs-keyword">this</span>.locale.error_where.format(where))
		}
		<span class="hljs-keyword">this</span>.options.day = to.start.getFullYear() + <span class="hljs-string">'-'</span> + to.start.getMonthFormatted() + <span class="hljs-string">'-'</span> + to.start.getDateFormatted();
		<span class="hljs-keyword">this</span>.view();
		<span class="hljs-keyword">if</span>(_.isFunction(next)) {
			next();
		}
	};

	Calendar.prototype._init_position = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
		<span class="hljs-keyword">var</span> year, month, day;

		<span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.options.day == <span class="hljs-string">'now'</span>) {
			<span class="hljs-keyword">var</span> date = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();
			year = date.getFullYear();
			month = date.getMonth();
			day = date.getDate();
		} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.options.day.match(<span class="hljs-regexp">/^\d{4}-\d{2}-\d{2}$/g</span>)) {
			<span class="hljs-keyword">var</span> list = <span class="hljs-keyword">this</span>.options.day.split(<span class="hljs-string">'-'</span>);
			year = <span class="hljs-built_in">parseInt</span>(list[<span class="hljs-number">0</span>], <span class="hljs-number">10</span>);
			month = <span class="hljs-built_in">parseInt</span>(list[<span class="hljs-number">1</span>], <span class="hljs-number">10</span>) - <span class="hljs-number">1</span>;
			day = <span class="hljs-built_in">parseInt</span>(list[<span class="hljs-number">2</span>], <span class="hljs-number">10</span>);
		}
		<span class="hljs-keyword">else</span> {
			$.error(<span class="hljs-keyword">this</span>.locale.error_dateformat.format(<span class="hljs-keyword">this</span>.options.day));
		}

		<span class="hljs-keyword">switch</span>(<span class="hljs-keyword">this</span>.options.view) {
			<span class="hljs-keyword">case</span> <span class="hljs-string">'year'</span>:
				<span class="hljs-keyword">this</span>.options.position.start.setTime(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(year, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>).getTime());
				<span class="hljs-keyword">this</span>.options.position.end.setTime(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(year + <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>).getTime());
				<span class="hljs-keyword">break</span>;
			<span class="hljs-keyword">case</span> <span class="hljs-string">'month'</span>:
				<span class="hljs-keyword">this</span>.options.position.start.setTime(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(year, month, <span class="hljs-number">1</span>).getTime());
				<span class="hljs-keyword">this</span>.options.position.end.setTime(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(year, month + <span class="hljs-number">1</span>, <span class="hljs-number">1</span>).getTime());
				<span class="hljs-keyword">break</span>;
			<span class="hljs-keyword">case</span> <span class="hljs-string">'day'</span>:
				<span class="hljs-keyword">this</span>.options.position.start.setTime(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(year, month, day).getTime());
				<span class="hljs-keyword">this</span>.options.position.end.setTime(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(year, month, day + <span class="hljs-number">1</span>).getTime());
				<span class="hljs-keyword">break</span>;
			<span class="hljs-keyword">case</span> <span class="hljs-string">'week'</span>:
				<span class="hljs-keyword">var</span> curr = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(year, month, day);
				<span class="hljs-keyword">var</span> first;
				<span class="hljs-keyword">if</span>(getExtentedOption(<span class="hljs-keyword">this</span>, <span class="hljs-string">'first_day'</span>) == <span class="hljs-number">1</span>) {
					first = curr.getDate() - ((curr.getDay() + <span class="hljs-number">6</span>) % <span class="hljs-number">7</span>);
				}
				<span class="hljs-keyword">else</span> {
					first = curr.getDate() - curr.getDay();
				}
				<span class="hljs-keyword">this</span>.options.position.start.setTime(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(year, month, first).getTime());
				<span class="hljs-keyword">this</span>.options.position.end.setTime(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(year, month, first + <span class="hljs-number">7</span>).getTime());
				<span class="hljs-keyword">break</span>;
			<span class="hljs-keyword">default</span>:
				$.error(<span class="hljs-keyword">this</span>.locale.error_noview.format(<span class="hljs-keyword">this</span>.options.view))
		}
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
	};

	Calendar.prototype.getTitle = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
		<span class="hljs-keyword">var</span> p = <span class="hljs-keyword">this</span>.options.position.start;
		<span class="hljs-keyword">switch</span>(<span class="hljs-keyword">this</span>.options.view) {
			<span class="hljs-keyword">case</span> <span class="hljs-string">'year'</span>:
				<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.locale.title_year.format(p.getFullYear());
				<span class="hljs-keyword">break</span>;
			<span class="hljs-keyword">case</span> <span class="hljs-string">'month'</span>:
				<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.locale.title_month.format(<span class="hljs-keyword">this</span>.locale[<span class="hljs-string">'m'</span> + p.getMonth()], p.getFullYear());
				<span class="hljs-keyword">break</span>;
			<span class="hljs-keyword">case</span> <span class="hljs-string">'week'</span>:
				<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.locale.title_week.format(p.getWeek(), p.getFullYear());
				<span class="hljs-keyword">break</span>;
			<span class="hljs-keyword">case</span> <span class="hljs-string">'day'</span>:
				<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.locale.title_day.format(<span class="hljs-keyword">this</span>.locale[<span class="hljs-string">'d'</span> + p.getDay()], p.getDate(), <span class="hljs-keyword">this</span>.locale[<span class="hljs-string">'m'</span> + p.getMonth()], p.getFullYear());
				<span class="hljs-keyword">break</span>;
		}
		<span class="hljs-keyword">return</span>;
	};

	Calendar.prototype.isToday = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
		<span class="hljs-keyword">var</span> now = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime();

		<span class="hljs-keyword">return</span> ((now &gt; <span class="hljs-keyword">this</span>.options.position.start) &amp;&amp; (now &lt; <span class="hljs-keyword">this</span>.options.position.end));
	}

	Calendar.prototype.getStartDate = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.options.position.start;
	}

	Calendar.prototype.getEndDate = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.options.position.end;
	}

	Calendar.prototype._loadEvents = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
		<span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
		<span class="hljs-keyword">var</span> source = <span class="hljs-literal">null</span>;
		<span class="hljs-keyword">if</span>(<span class="hljs-string">'events_source'</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">this</span>.options &amp;&amp; <span class="hljs-keyword">this</span>.options.events_source !== <span class="hljs-string">''</span>) {
			source = <span class="hljs-keyword">this</span>.options.events_source;
		}
		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">'events_url'</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">this</span>.options) {
			source = <span class="hljs-keyword">this</span>.options.events_url;
			warn(<span class="hljs-string">'The events_url option is DEPRECATED and it will be REMOVED in near future. Please use events_source instead.'</span>);
		}
		<span class="hljs-keyword">var</span> loader;
		<span class="hljs-keyword">switch</span>($.type(source)) {
			<span class="hljs-keyword">case</span> <span class="hljs-string">'function'</span>:
				loader = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
					<span class="hljs-keyword">return</span> source(self.options.position.start, self.options.position.end, browser_timezone);
				};
				<span class="hljs-keyword">break</span>;
			<span class="hljs-keyword">case</span> <span class="hljs-string">'array'</span>:
				loader = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
					<span class="hljs-keyword">return</span> [].concat(source);
				};
				<span class="hljs-keyword">break</span>;
			<span class="hljs-keyword">case</span> <span class="hljs-string">'string'</span>:
				<span class="hljs-keyword">if</span>(source.length) {
					loader = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
						<span class="hljs-keyword">var</span> events = [];
						<span class="hljs-keyword">var</span> params = {from: self.options.position.start.getTime(), to: self.options.position.end.getTime()};
						<span class="hljs-keyword">if</span>(browser_timezone.length) {
							params.browser_timezone = browser_timezone;
						}
						$.ajax({
							url:      buildEventsUrl(source, params),
							dataType: <span class="hljs-string">'json'</span>,
							type:     <span class="hljs-string">'GET'</span>,
							async:    <span class="hljs-literal">false</span>
						}).done(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(json)</span> {</span>
							<span class="hljs-keyword">if</span>(!json.success) {
								$.error(json.error);
							}
							<span class="hljs-keyword">if</span>(json.result) {
								events = json.result;
							}
						});
						<span class="hljs-keyword">return</span> events;
					};
				}
				<span class="hljs-keyword">break</span>;
		}
		<span class="hljs-keyword">if</span>(!loader) {
			$.error(<span class="hljs-keyword">this</span>.locale.error_loadurl);
		}
		<span class="hljs-keyword">this</span>.options.onBeforeEventsLoad.call(<span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
			self.options.events = loader();
			self.options.events.sort(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a, b)</span> {</span>
				<span class="hljs-keyword">var</span> delta;
				delta = a.start - b.start;
				<span class="hljs-keyword">if</span>(delta == <span class="hljs-number">0</span>) {
					delta = a.end - b.end;
				}
				<span class="hljs-keyword">return</span> delta;
			});
			self.options.onAfterEventsLoad.call(self, self.options.events);
		});
	};

	Calendar.prototype._templatePath = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name)</span> {</span>
		<span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> <span class="hljs-keyword">this</span>.options.tmpl_path == <span class="hljs-string">'function'</span>) {
			<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.options.tmpl_path(name)
		}
		<span class="hljs-keyword">else</span> {
			<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.options.tmpl_path + name + <span class="hljs-string">'.html'</span>;
		}
	};

	Calendar.prototype._loadTemplate = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name)</span> {</span>
		<span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.options.templates[name]) {
			<span class="hljs-keyword">return</span>;
		}
		<span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
		$.ajax({
			url:      self._templatePath(name),
			dataType: <span class="hljs-string">'html'</span>,
			type:     <span class="hljs-string">'GET'</span>,
			async:    <span class="hljs-literal">false</span>,
			cache:    <span class="hljs-keyword">this</span>.options.tmpl_cache
		}).done(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(html)</span> {</span>
			self.options.templates[name] = _.template(html);
		});
	};

	Calendar.prototype._update = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
		<span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;

		$(<span class="hljs-string">'*[data-toggle="tooltip"]'</span>).tooltip({container: <span class="hljs-string">'body'</span>});

		$(<span class="hljs-string">'*[data-cal-date]'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
			<span class="hljs-keyword">var</span> view = $(<span class="hljs-keyword">this</span>).data(<span class="hljs-string">'cal-view'</span>);
			self.options.day = $(<span class="hljs-keyword">this</span>).data(<span class="hljs-string">'cal-date'</span>);
			self.view(view);
		});
		$(<span class="hljs-string">'.cal-cell'</span>).dblclick(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
			<span class="hljs-keyword">var</span> view = $(<span class="hljs-string">'[data-cal-date]'</span>, <span class="hljs-keyword">this</span>).data(<span class="hljs-string">'cal-view'</span>);
			self.options.day = $(<span class="hljs-string">'[data-cal-date]'</span>, <span class="hljs-keyword">this</span>).data(<span class="hljs-string">'cal-date'</span>);
			self.view(view);
		});

		<span class="hljs-keyword">this</span>[<span class="hljs-string">'_update_'</span> + <span class="hljs-keyword">this</span>.options.view]();

		<span class="hljs-keyword">this</span>._update_modal();

	};

	Calendar.prototype._update_modal = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
		<span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;

		$(<span class="hljs-string">'a[data-event-id]'</span>, <span class="hljs-keyword">this</span>.context).unbind(<span class="hljs-string">'click'</span>);

		<span class="hljs-keyword">if</span>(!self.options.modal) {
			<span class="hljs-keyword">return</span>;
		}

		<span class="hljs-keyword">var</span> modal = $(self.options.modal);

		<span class="hljs-keyword">if</span>(!modal.length) {
			<span class="hljs-keyword">return</span>;
		}

		<span class="hljs-keyword">var</span> ifrm = <span class="hljs-literal">null</span>;
		<span class="hljs-keyword">if</span>(self.options.modal_type == <span class="hljs-string">"iframe"</span>) {
			ifrm = $(document.createElement(<span class="hljs-string">"iframe"</span>))
				.attr({
					width:       <span class="hljs-string">"100%"</span>,
					frameborder: <span class="hljs-string">"0"</span>
				});
		}


		$(<span class="hljs-string">'a[data-event-id]'</span>, <span class="hljs-keyword">this</span>.context).on(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(event)</span> {</span>
			event.preventDefault();
			event.stopPropagation();

			<span class="hljs-keyword">var</span> url = $(<span class="hljs-keyword">this</span>).attr(<span class="hljs-string">'href'</span>);
			<span class="hljs-keyword">var</span> id = $(<span class="hljs-keyword">this</span>).data(<span class="hljs-string">"event-id"</span>);
			<span class="hljs-keyword">var</span> event = _.find(self.options.events, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(event)</span> {</span>
				<span class="hljs-keyword">return</span> event.id == id
			});

			<span class="hljs-keyword">if</span>(self.options.modal_type == <span class="hljs-string">"iframe"</span>) {
				ifrm.attr(<span class="hljs-string">'src'</span>, url);
				$(<span class="hljs-string">'.modal-body'</span>, modal).html(ifrm);
			}

			<span class="hljs-keyword">if</span>(!modal.data(<span class="hljs-string">'handled.bootstrap-calendar'</span>) || (modal.data(<span class="hljs-string">'handled.bootstrap-calendar'</span>) &amp;&amp; modal.data(<span class="hljs-string">'handled.event-id'</span>) != event.id)) {
				modal	.off(<span class="hljs-string">'show.bs.modal'</span>)
					.off(<span class="hljs-string">'shown.bs.modal'</span>)
					.off(<span class="hljs-string">'hidden.bs.modal'</span>)
					.on(<span class="hljs-string">'show.bs.modal'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
						<span class="hljs-keyword">var</span> modal_body = $(<span class="hljs-keyword">this</span>).find(<span class="hljs-string">'.modal-body'</span>);
						<span class="hljs-keyword">switch</span>(self.options.modal_type) {
							<span class="hljs-keyword">case</span> <span class="hljs-string">"iframe"</span> :
								<span class="hljs-keyword">var</span> height = modal_body.height() - <span class="hljs-built_in">parseInt</span>(modal_body.css(<span class="hljs-string">'padding-top'</span>), <span class="hljs-number">10</span>) - <span class="hljs-built_in">parseInt</span>(modal_body.css(<span class="hljs-string">'padding-bottom'</span>), <span class="hljs-number">10</span>);
								$(<span class="hljs-keyword">this</span>).find(<span class="hljs-string">'iframe'</span>).height(<span class="hljs-built_in">Math</span>.max(height, <span class="hljs-number">50</span>));
								<span class="hljs-keyword">break</span>;

							<span class="hljs-keyword">case</span> <span class="hljs-string">"ajax"</span>:
								$.ajax({url: url, dataType: <span class="hljs-string">"html"</span>, async: <span class="hljs-literal">false</span>, success: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span> {</span>
									modal_body.html(data);
								}});
								<span class="hljs-keyword">break</span>;

							<span class="hljs-keyword">case</span> <span class="hljs-string">"template"</span>:
								self._loadTemplate(<span class="hljs-string">"modal"</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>also serve calendar instance to underscore template to be able to access current language strings</p></div></div><div class="code"><div class="wrapper">								modal_body.html(self.options.templates[<span class="hljs-string">"modal"</span>]({<span class="hljs-string">"event"</span>: event, <span class="hljs-string">"calendar"</span>: self}))
								<span class="hljs-keyword">break</span>;
						}</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>set the title of the bootstrap modal</p></div></div><div class="code"><div class="wrapper">						<span class="hljs-keyword">if</span>(_.isFunction(self.options.modal_title)) {
							modal.find(<span class="hljs-string">"h3"</span>).html(self.options.modal_title(event));
						}
					})
					.on(<span class="hljs-string">'shown.bs.modal'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
						self.options.onAfterModalShown.call(self, self.options.events);
					})
					.on(<span class="hljs-string">'hidden.bs.modal'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
						self.options.onAfterModalHidden.call(self, self.options.events);
					})
					.data(<span class="hljs-string">'handled.bootstrap-calendar'</span>, <span class="hljs-literal">true</span>).data(<span class="hljs-string">'handled.event-id'</span>, event.id);
			}
			modal.modal(<span class="hljs-string">'show'</span>);
		});
	};

	Calendar.prototype._update_day = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
		$(<span class="hljs-string">'#cal-day-panel'</span>).height($(<span class="hljs-string">'#cal-day-panel-hour'</span>).height());
	};

	Calendar.prototype._update_week = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
	};

	Calendar.prototype._update_year = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
		<span class="hljs-keyword">this</span>._update_month_year();
	};

	Calendar.prototype._update_month = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
		<span class="hljs-keyword">this</span>._update_month_year();

		<span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;

		<span class="hljs-keyword">var</span> week = $(document.createElement(<span class="hljs-string">'div'</span>)).attr(<span class="hljs-string">'id'</span>, <span class="hljs-string">'cal-week-box'</span>);
		<span class="hljs-keyword">var</span> start = <span class="hljs-keyword">this</span>.options.position.start.getFullYear() + <span class="hljs-string">'-'</span> + <span class="hljs-keyword">this</span>.options.position.start.getMonthFormatted() + <span class="hljs-string">'-'</span>;
		$(<span class="hljs-string">'.cal-month-box .cal-row-fluid'</span>)
			.on(<span class="hljs-string">'mouseenter'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
				<span class="hljs-keyword">var</span> p = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(self.options.position.start);
				<span class="hljs-keyword">var</span> child = $(<span class="hljs-string">'.cal-cell1:first-child .cal-month-day'</span>, <span class="hljs-keyword">this</span>);
				<span class="hljs-keyword">var</span> day = (child.hasClass(<span class="hljs-string">'cal-month-first-row'</span>) ? <span class="hljs-number">1</span> : $(<span class="hljs-string">'[data-cal-date]'</span>, child).text());
				p.setDate(<span class="hljs-built_in">parseInt</span>(day));
				day = (day &lt; <span class="hljs-number">10</span> ? <span class="hljs-string">'0'</span> + day : day);
				week.html(self.locale.week.format(p.getWeek()));
				week.attr(<span class="hljs-string">'data-cal-week'</span>, start + day).show().appendTo(child);
			})
			.on(<span class="hljs-string">'mouseleave'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
				week.hide();
			})
		;

		week.click(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
			self.options.day = $(<span class="hljs-keyword">this</span>).data(<span class="hljs-string">'cal-week'</span>);
			self.view(<span class="hljs-string">'week'</span>);
		});

		$(<span class="hljs-string">'a.event'</span>).mouseenter(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
			$(<span class="hljs-string">'a[data-event-id="'</span> + $(<span class="hljs-keyword">this</span>).data(<span class="hljs-string">'event-id'</span>) + <span class="hljs-string">'"]'</span>).closest(<span class="hljs-string">'.cal-cell1'</span>).addClass(<span class="hljs-string">'day-highlight dh-'</span> + $(<span class="hljs-keyword">this</span>).data(<span class="hljs-string">'event-class'</span>));
		});
		$(<span class="hljs-string">'a.event'</span>).mouseleave(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
			$(<span class="hljs-string">'div.cal-cell1'</span>).removeClass(<span class="hljs-string">'day-highlight dh-'</span> + $(<span class="hljs-keyword">this</span>).data(<span class="hljs-string">'event-class'</span>));
		});
	};

	Calendar.prototype._update_month_year = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
		<span class="hljs-keyword">if</span>(!<span class="hljs-keyword">this</span>.options.views[<span class="hljs-keyword">this</span>.options.view].slide_events) {
			<span class="hljs-keyword">return</span>;
		}
		<span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
		<span class="hljs-keyword">var</span> activecell = <span class="hljs-number">0</span>;
		<span class="hljs-keyword">var</span> downbox = $(document.createElement(<span class="hljs-string">'div'</span>)).attr(<span class="hljs-string">'id'</span>, <span class="hljs-string">'cal-day-tick'</span>).html(<span class="hljs-string">'&lt;i class="icon-chevron-down glyphicon glyphicon-chevron-down"&gt;&lt;/i&gt;'</span>);

		$(<span class="hljs-string">'.cal-month-day, .cal-year-box .span3'</span>)
			.on(<span class="hljs-string">'mouseenter'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
				<span class="hljs-keyword">if</span>($(<span class="hljs-string">'.events-list'</span>, <span class="hljs-keyword">this</span>).length == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;
				<span class="hljs-keyword">if</span>($(<span class="hljs-keyword">this</span>).children(<span class="hljs-string">'[data-cal-date]'</span>).text() == self.activecell) <span class="hljs-keyword">return</span>;
				downbox.show().appendTo(<span class="hljs-keyword">this</span>);
			})
			.on(<span class="hljs-string">'mouseleave'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
				downbox.hide();
			})
			.on(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(event)</span> {</span>
				<span class="hljs-keyword">if</span>($(<span class="hljs-string">'.events-list'</span>, <span class="hljs-keyword">this</span>).length == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;
				<span class="hljs-keyword">if</span>($(<span class="hljs-keyword">this</span>).children(<span class="hljs-string">'[data-cal-date]'</span>).text() == self.activecell) <span class="hljs-keyword">return</span>;
				showEventsList(event, downbox, slider, self);
			})
		;

		<span class="hljs-keyword">var</span> slider = $(document.createElement(<span class="hljs-string">'div'</span>)).attr(<span class="hljs-string">'id'</span>, <span class="hljs-string">'cal-slide-box'</span>);
		slider.hide().click(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(event)</span> {</span>
			event.stopPropagation();
		});

		<span class="hljs-keyword">this</span>._loadTemplate(<span class="hljs-string">'events-list'</span>);

		downbox.click(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(event)</span> {</span>
			showEventsList(event, $(<span class="hljs-keyword">this</span>), slider, self);
		});
	};

	Calendar.prototype.getEventsBetween = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(start, end)</span> {</span>
		<span class="hljs-keyword">var</span> events = [];
		$.each(<span class="hljs-keyword">this</span>.options.events, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
			<span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.start == <span class="hljs-literal">null</span>) {
				<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
			}
			<span class="hljs-keyword">var</span> event_end = <span class="hljs-keyword">this</span>.end || <span class="hljs-keyword">this</span>.start;
			<span class="hljs-keyword">if</span>((<span class="hljs-built_in">parseInt</span>(<span class="hljs-keyword">this</span>.start) &lt; end) &amp;&amp; (<span class="hljs-built_in">parseInt</span>(event_end) &gt;= start)) {
				events.push(<span class="hljs-keyword">this</span>);
			}
		});
		<span class="hljs-keyword">return</span> events;
	};

	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">showEventsList</span><span class="hljs-params">(event, that, slider, self)</span> {</span>

		event.stopPropagation();

		<span class="hljs-keyword">var</span> that = $(that);
		<span class="hljs-keyword">var</span> cell = that.closest(<span class="hljs-string">'.cal-cell'</span>);
		<span class="hljs-keyword">var</span> row = cell.closest(<span class="hljs-string">'.cal-before-eventlist'</span>);
		<span class="hljs-keyword">var</span> tick_position = cell.data(<span class="hljs-string">'cal-row'</span>);

		that.fadeOut(<span class="hljs-string">'fast'</span>);

		slider.slideUp(<span class="hljs-string">'fast'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
			<span class="hljs-keyword">var</span> event_list = $(<span class="hljs-string">'.events-list'</span>, cell);
			slider.html(self.options.templates[<span class="hljs-string">'events-list'</span>]({
				cal:    self,
				events: self.getEventsBetween(<span class="hljs-built_in">parseInt</span>(event_list.data(<span class="hljs-string">'cal-start'</span>)), <span class="hljs-built_in">parseInt</span>(event_list.data(<span class="hljs-string">'cal-end'</span>)))
			}));
			row.after(slider);
			self.activecell = $(<span class="hljs-string">'[data-cal-date]'</span>, cell).text();
			$(<span class="hljs-string">'#cal-slide-tick'</span>).addClass(<span class="hljs-string">'tick'</span> + tick_position).show();
			slider.slideDown(<span class="hljs-string">'fast'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
				$(<span class="hljs-string">'body'</span>).one(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
					slider.slideUp(<span class="hljs-string">'fast'</span>);
					self.activecell = <span class="hljs-number">0</span>;
				});
			});
		});

	</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Wait 400ms before updating the modal &amp; attach the mouseenter&amp;mouseleave(400ms is the time for the slider to fade out and slide up)</p></div></div><div class="code"><div class="wrapper">		setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
			$(<span class="hljs-string">'a.event-item'</span>).mouseenter(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
				$(<span class="hljs-string">'a[data-event-id="'</span> + $(<span class="hljs-keyword">this</span>).data(<span class="hljs-string">'event-id'</span>) + <span class="hljs-string">'"]'</span>).closest(<span class="hljs-string">'.cal-cell1'</span>).addClass(<span class="hljs-string">'day-highlight dh-'</span> + $(<span class="hljs-keyword">this</span>).data(<span class="hljs-string">'event-class'</span>));
			});
			$(<span class="hljs-string">'a.event-item'</span>).mouseleave(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
				$(<span class="hljs-string">'div.cal-cell1'</span>).removeClass(<span class="hljs-string">'day-highlight dh-'</span> + $(<span class="hljs-keyword">this</span>).data(<span class="hljs-string">'event-class'</span>));
			});
			self._update_modal();
		}, <span class="hljs-number">400</span>);
	}

	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getEasterDate</span><span class="hljs-params">(year, offsetDays)</span> {</span>
		<span class="hljs-keyword">var</span> a = year % <span class="hljs-number">19</span>;
		<span class="hljs-keyword">var</span> b = <span class="hljs-built_in">Math</span>.floor(year / <span class="hljs-number">100</span>);
		<span class="hljs-keyword">var</span> c = year % <span class="hljs-number">100</span>;
		<span class="hljs-keyword">var</span> d = <span class="hljs-built_in">Math</span>.floor(b / <span class="hljs-number">4</span>);
		<span class="hljs-keyword">var</span> e = b % <span class="hljs-number">4</span>;
		<span class="hljs-keyword">var</span> f = <span class="hljs-built_in">Math</span>.floor((b + <span class="hljs-number">8</span>) / <span class="hljs-number">25</span>);
		<span class="hljs-keyword">var</span> g = <span class="hljs-built_in">Math</span>.floor((b - f + <span class="hljs-number">1</span>) / <span class="hljs-number">3</span>);
		<span class="hljs-keyword">var</span> h = (<span class="hljs-number">19</span> * a + b - d - g + <span class="hljs-number">15</span>) % <span class="hljs-number">30</span>;
		<span class="hljs-keyword">var</span> i = <span class="hljs-built_in">Math</span>.floor(c / <span class="hljs-number">4</span>);
		<span class="hljs-keyword">var</span> k = c % <span class="hljs-number">4</span>;
		<span class="hljs-keyword">var</span> l = (<span class="hljs-number">32</span> + <span class="hljs-number">2</span> * e + <span class="hljs-number">2</span> * i - h - k) % <span class="hljs-number">7</span>;
		<span class="hljs-keyword">var</span> m = <span class="hljs-built_in">Math</span>.floor((a + <span class="hljs-number">11</span> * h + <span class="hljs-number">22</span> * l) / <span class="hljs-number">451</span>);
		<span class="hljs-keyword">var</span> n0 = (h + l + <span class="hljs-number">7</span> * m + <span class="hljs-number">114</span>)
		<span class="hljs-keyword">var</span> n = <span class="hljs-built_in">Math</span>.floor(n0 / <span class="hljs-number">31</span>) - <span class="hljs-number">1</span>;
		<span class="hljs-keyword">var</span> p = n0 % <span class="hljs-number">31</span> + <span class="hljs-number">1</span>;
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(year, n, p + (offsetDays ? offsetDays : <span class="hljs-number">0</span>), <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
	}

	$.fn.calendar = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(params)</span> {</span>
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Calendar(params, <span class="hljs-keyword">this</span>);
	}
}(jQuery));</div></div></div></div></body></html>